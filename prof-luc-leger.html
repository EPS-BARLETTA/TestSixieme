<!DOCTYPE html><html lang="fr"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Luc Léger — Mode Prof</title>
<style>
  body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Inter,Roboto,sans-serif;background:#0b1324;color:#fff}
  .wrap{max-width:960px;margin:0 auto;padding:20px}
  .card{background:#0f172a;border:1px solid #1f2937;border-radius:16px;padding:18px;box-shadow:0 10px 26px rgba(0,0,0,.25);}
  h1{margin:0 0 8px}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  .k{flex:1;min-width:200px;text-align:center;background:#111827;border-radius:12px;padding:14px}
  .k .big{font-size:56px;font-weight:800;letter-spacing:.5px}
  .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  button{padding:12px 16px;border-radius:12px;border:none;font-weight:800;cursor:pointer}
  .start{background:#22c55e;color:#0b1324}
  .stop{background:#ef4444}
  .pause{background:#f59e0b;color:#0b1324}
  .ok{background:#3b82f6}
  .input{padding:10px 12px;border-radius:10px;border:1px solid #334155;background:#0b1220;color:#fff}
  .note{opacity:.8;font-size:14px}
</style>
</head>
<body><div class="wrap">
  <h1>Test Luc Léger — Mode Prof</h1>
  <div class="card">
    <div class="row">
      <div class="k"><div>Palier</div><div class="big" id="palier">1</div></div>
      <div class="k"><div>Navette</div><div class="big" id="navette">1</div></div>
      <div class="k"><div>Vitesse cible (km/h)</div><div class="big" id="vitesse">8.5</div></div>
      <div class="k"><div>Temps pour 20m (s)</div><div class="big" id="t20">8.47</div></div>
    </div>
    <div class="controls">
      <input class="input" id="code" placeholder="Code prof (ex: 57)" inputmode="numeric" />
      <button class="start" id="btnStart">Démarrer</button>
      <button class="pause" id="btnPause" disabled>Pause</button>
      <button class="ok" id="btnNext" disabled>Navette +1</button>
      <button class="stop" id="btnStop" disabled>Arrêter</button>
    </div>
    <p class="note">Raccourcis : Espace = Pause/Play, N = Navette+1, S = Stop.</p>
  </div>
</div>
<script>
/* Luc Léger — version autonome (WebAudio bip) */
const PALIER_MAX = 21;
const codeProf = '57';
const palierNavettes = [0,7,8,8,9,9,10,10,11,11,11,12,12,13,13,13,13,13,13,13,13,13]; // 1..21
let palier = 1, navette = 1, running = false, timer=null, audioCtx=null;

function speedForPalier(p){ return 8 + 0.5*p; } // 1 -> 8.5; 2 -> 9.0 ...
function tPer20m(p){ return 72 / speedForPalier(p); } // secondes pour 20m
function fmt(n){ return (Math.round(n*100)/100).toFixed(2); }

function ui(){ 
  document.getElementById('palier').textContent = palier;
  document.getElementById('navette').textContent = navette;
  document.getElementById('vitesse').textContent = fmt(speedForPalier(palier));
  document.getElementById('t20').textContent = fmt(tPer20m(palier));
}

function beep(){
  if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type='sine'; o.frequency.value=1000;
  g.gain.value=0.1;
  o.connect(g).connect(audioCtx.destination);
  o.start();
  setTimeout(()=>o.stop(), 120);
}

function schedule(){
  if(!running) return;
  const dt = tPer20m(palier)*1000;
  clearTimeout(timer);
  timer = setTimeout(()=>{
    beep();
    navette++;
    const maxN = palierNavettes[palier]||10;
    if(navette > maxN){
      palier++;
      navette = 1;
      if(palier>PALIER_MAX){ stop(); return; }
    }
    ui();
    schedule();
  }, dt);
}

function start(){
  const code = document.getElementById('code').value.trim();
  if(code !== codeProf){ alert('Code incorrect'); return; }
  running = true;
  document.getElementById('btnPause').disabled=false;
  document.getElementById('btnNext').disabled=false;
  document.getElementById('btnStop').disabled=false;
  document.getElementById('btnStart').disabled=true;
  beep();
  schedule();
}

function stop(){
  running=false; clearTimeout(timer);
  document.getElementById('btnPause').disabled=true;
  document.getElementById('btnNext').disabled=true;
  document.getElementById('btnStop').disabled=true;
  document.getElementById('btnStart').disabled=false;
}

function pause(){
  running = !running;
  if(running){ schedule(); }
  else{ clearTimeout(timer); }
}

function next(){
  navette++;
  const maxN = palierNavettes[palier]||10;
  if(navette > maxN){
    palier++;
    navette = 1;
    if(palier>PALIER_MAX){ stop(); return; }
  }
  beep();
  ui();
}

document.getElementById('btnStart').addEventListener('click', start);
document.getElementById('btnStop').addEventListener('click', stop);
document.getElementById('btnPause').addEventListener('click', pause);
document.getElementById('btnNext').addEventListener('click', next);
document.addEventListener('keydown', (e)=>{
  if(e.code==='Space'){ e.preventDefault(); pause(); }
  if(e.key==='n' || e.key==='N'){ next(); }
  if(e.key==='s' || e.key==='S'){ stop(); }
});
ui();
</script>
<script src="ui-autoinject.js"></script>
</body></html>
